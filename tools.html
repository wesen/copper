<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./intro.html"><strong>1.</strong> Introduction</a></li><li><ul class="section"><li><a href="./audience.html"><strong>1.1.</strong> Audience</a></li><li><a href="./why-rust.html"><strong>1.2.</strong> Why Rust?</a></li><li><a href="./why-arm.html"><strong>1.3.</strong> Why ARM Cortex-M micros?</a></li><li><a href="./what-dev-board.html"><strong>1.4.</strong> What dev board should I use/get?</a></li></ul></li><li><a href="./tools.html" class="active"><strong>2.</strong> Setting up a development environment</a></li><li><ul class="section"><li><a href="./linux.html"><strong>2.1.</strong> Linux</a></li><li><a href="./macos.html"><strong>2.2.</strong> macOS</a></li><li><a href="./windows.html"><strong>2.3.</strong> Windows</a></li></ul></li><li><a href="./first/prog.html"><strong>3.</strong> First program</a></li><li><ul class="section"><li><a href="./first/build.html"><strong>3.1.</strong> Build &amp; inspect</a></li><li><a href="./first/qemu.html"><strong>3.2.</strong> Run it under QEMU</a></li><li><a href="./details.html"><strong>3.3.</strong> Nitty-gritty details</a></li><li><ul class="section"><li><a href="./details/target.html"><strong>3.3.1.</strong> Target specification</a></li><li><a href="./details/boot.html"><strong>3.3.2.</strong> Boot process</a></li><li><a href="./details/ld.html"><strong>3.3.3.</strong> Linker script</a></li></ul></li><li><a href="./first/flash.html"><strong>3.4.</strong> Run it on real hardware</a></li></ul></li><li><a href="./exceptions.html"><strong>4.</strong> Exceptions: Crashing your micro</a></li><li><a href="./blink.html"><strong>5.</strong> Blinking an LED</a></li><li class="spacer"></li><li class="affix">Work In Progress chapters</li><li class="affix"><a href="./optimize.html">(Mis)Optimization</a></li><li class="affix"><a href="registers.html">Zero-cost type-safe register manipulation</a></li><li class="affix"><a href="hal.html">Abstracting Hardware</a></li><li class="affix"><a href="./peripherals.html">Peripherals</a></li><li class="spacer"></li><li class="affix"><a href="./unwritten.html">Unwritten topics</a></li><li class="spacer"></li><li class="affix"><a href="./resources.html">Resources</a></li><li class="affix"><a href="./faq.html">FAQ</a></li><li class="spacer"></li><li class="affix">Published using mdBook</li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <h1>Setting up a development environment</h1>
<p>Working with embedded systems requires extra tooling as cross compilation is at
the heart of the development process. This chapter will introduce the tools
we'll use, why we need them and how to install them on the 3 major OSes.</p>
<p>Without further ado, these are the tools we'll use:</p>
<ul>
<li><a href="tools.html#Rust%20%26%20Cargo%3A%20nightly%20edition">Rust &amp; Cargo: nightly edition</a></li>
<li><a href="tools.html#A%20cross%20C%20linker%3A%20arm-none-eabi-gcc">A cross C linker: arm-none-eabi-gcc</a></li>
<li><a href="tools.html#Binary%20inspection%20tools">Binary inspection tools</a>
<ul>
<li><a href="tools.html#arm-none-eabi-objdump">arm-none-eabi-objdump</a></li>
<li><a href="tools.html#arm-none-eabi-size">arm-none-eabi-size</a></li>
</ul>
</li>
<li><a href="tools.html#A%20debugger">A debugger</a></li>
<li><a href="tools.html#An%20emulator%3A%20QEMU">An emulator: QEMU</a></li>
<li><a href="tools.html#Xargo">Xargo</a></li>
<li><a href="tools.html#OpenOCD">OpenOCD</a></li>
</ul>
<p>The rest of this page will justify each of these tools. For installation
instructions check the subsections of this chapter: <a href="linux.html">Linux</a>, <a href="macos.html">Mac</a> and <a href="windows.html">Windows</a></p>
<h2>Rust &amp; Cargo: nightly edition</h2>
<p>Rust &amp; Cargo don't need  much explanation. To build Rust programs we'll need the
Rust compiler, <code>rustc</code>, and the Rust package manager, Cargo.</p>
<p>What does need justification is the use of the nightly channel. We need to use
the nightly channel because we'll make use of the following unstable features:</p>
<ul>
<li>
<p><code>asm</code>: We'll use some inline assembly via the <code>asm!</code> syntax extension. But
that syntax extension hasn't been stabilized.</p>
</li>
<li>
<p><code>lang_items</code>: The need for this feature gate is sometimes artificial. The
compiler demands some lang times, like <code>panic_fmt</code>, to be defined even if the
functionality they provide (unwinding/panicking) is never used in our program.</p>
</li>
<li>
<p>To cross compile programs we need a cross compiled <code>core</code> crate. The Rust
project doesn't distribute a binary release of that crate for Cortex-M
microcontrollers so we have to cross compile that crate ourselves. As the
<code>core</code> crate relies on lots of unstable features, we have to use the nightly
channel to cross compile it.</p>
</li>
</ul>
<h2>A cross C linker: <code>arm-none-eabi-gcc</code></h2>
<p>(<code>arm-none-eabi-gcc</code> is not a linker per se but <code>rustc</code> uses it as a proxy for
<code>arm-none-eabi-ld</code>.)</p>
<blockquote>
<p>Wait, aren't we going to write Rust? Why do we need a <em>C compiler</em>?</p>
</blockquote>
<p><code>rustc</code> uses <code>gcc</code> to link intermediate object files so we pretty much have no
choice.</p>
<h2>Binary inspection tools</h2>
<p>When working this close to the hardware and with devices that have constrained
resources and mandatory memory layouts, it's pretty important to inspect the
produced binaries to keep track of their sizes and to check that the produced
binaries follow a specific memory layout.</p>
<p>We'll mainly use the following two tools:</p>
<h3><code>arm-none-eabi-size</code></h3>
<p>To keep an eye on the binary size of our applications.</p>
<h3><code>arm-none-eabi-objdump</code></h3>
<p>To confirm the memory layout of our program matches the memory layout
constraints of the target device.</p>
<h2>A debugger</h2>
<p>A debugger is vital when working with microcontrollers as other debugging
methods like logging or <em>cough</em> <code>println</code> may not be available. This is
specially true when you are just starting out and haven't yet written drivers
for peripherals that allow microcontroller &lt;-&gt; PC communication.</p>
<p>We'll mainly use <code>arm-none-eabi-gdb</code> in this document as <code>lldb</code> doesn't provide
all the functionality we need.</p>
<h2>An emulator: QEMU</h2>
<p>Before trying out our first program on real hardware, we'll run it under an
emulator to verify that the program works as expected.</p>
<h2>Xargo</h2>
<p>In general, cross compiling requires cross compiled &quot;standard&quot; crates like the
<code>core</code> or the <code>std</code> crate. Binary releases of these crates for Cortex-M
microcontrollers are not provided by the Rust project so we'll have to cross
compile these ourselves. Just cross compiling is not enough though, as one must
place the produced binaries in a specific directory layout called a &quot;sysroot&quot;.
Because this process is cumbersome and error prone, I have <a href="https://github.com/japaric/xargo">created Xargo</a>.
Xargo is a <em>transparent</em> Cargo wrapper that automatically builds and manages
sysroots without user intervention.</p>
<p>Usage looks like this:</p>
<pre><code>$ cargo build --target cortex-m3 &amp;&amp; echo OK
   Compiling app v0.1.0
error: can't find crate for `core` [E0463]

error: aborting due to previous error
error: Could not compile `app`.

To learn more, run the command again with --verbose.
</code></pre>
<pre><code>$ xargo build --target thumbv6m-none-eabi &amp;&amp; echo OK
   Compiling core v0.0.0 (file://$sysroot/lib/rustlib/src/rust/src/libcore)
   Compiling alloc v0.0.0 (file://$sysroot/lib/rustlib/src/rust/src/liballoc)
    Finished release [optimized] target(s) in 19.56 secs
   Compiling rustc_unicode v0.0.0 (file://$sysroot/lib/rustlib/src/rust/src/librustc_unicode)
   Compiling collections v0.0.0 (file://$sysroot/lib/rustlib/src/rust/src/libcollections)
    Finished release [optimized] target(s) in 5.67 secs
    Finished release [optimized] target(s) in 0.0 secs
   Compiling rand v0.0.0 (file://$sysroot/lib/rustlib/src/rust/src/librand)
    Finished release [optimized] target(s) in 1.78 secs
    Finished release [optimized] target(s) in 0.0 secs
   Compiling app v0.1.0 (file://$PWD)
OK
</code></pre>
<h2>OpenOCD</h2>
<p><a href="tools.html#OpenOCD">OpenOCD</a> is a tool that lets your computer communicate with devices that
support the JTAG/SWD communication protocol. We'll use OpenOCD to <em>flash</em>
(write) our programs into the microcontroller and to debug them (with the help
of <code>gdb</code>).</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="./what-dev-board.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="./linux.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./what-dev-board.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./linux.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
